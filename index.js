$(document).ready(function(){return d3.csv("2015-beijing.csv",function(e){var t,n,r,i,a,c,l,d,u,o,s,g,f,v,h,p;for(t=document.getElementById("container").getBoundingClientRect(),e=e.map(function(e){return{date:new Date(e["Date (LST)"]),value:e.Value}}),n=d3.extent(e.map(function(e){return parseInt(e.value)<0?0:parseInt(e.value)})),r=d3.extent(e.map(function(e){return e.date.getTime()})),i={},a=0,c=e.length;c>a;++a)l=e[a],l.idx=i[l.value]=((d=i[l.value])?d:0)+1;return u=d3.extent(e.map(function(e){return e.idx})),o=[0,50,100,350,400,722],console.log(n),s=d3.scale.linear().domain(r).range([0,t.width]),g=d3.scale.linear().domain(u).range([0,t.width]),f=d3.scale.linear().domain(n).range([t.height,0]),v=["#1d3263","#226c87","#f8d672","#e48e11","#e03215","#ab2321"],console.log(t),h=d3.select("#container").append("svg").attr({width:t.width+"px",height:t.height+"px",viewBox:[-20,-20,t.width+20,t.height+20].join(" "),preserveAspectRatio:"xMidYMid"}),h.selectAll("circle").data(e).enter().append("circle"),h.selectAll("circle").attr({r:3,fill:function(e){var t,n,r;for(t=0,n=o.length;n>t&&(r=t,!(e.value<o[r]));++t);return v[r]},cy:function(e){return f(e.value)}}).attr({cx:function(e){return s(e.date)}}),p=0,setInterval(function(){return p=1-p,0===p?h.selectAll("circle").transition().duration(2e3).attr({cx:function(e){return s(e.date)}}):1===p?h.selectAll("circle").transition().duration(2e3).attr({cx:function(e){return g(e.idx)}}):void 0},4e3)})});